# MCP Calculator Server

Sample Python MCP server exposing calculator tools (`add`, `subtract`, `multiply`, `divide`) for Claude Desktop.

## What this project is

This project runs a local MCP server over stdio. Claude Desktop connects to it and can call the exposed tools in chat.

## Prerequisites

1. Python 3.10+ installed and available in `PATH`.
What this is for: the server is written in Python and the `mcp` package requires modern Python.

2. `uv` installed and available in `PATH`.
What this is for: `uv` creates the virtual environment, installs dependencies, and runs the server in an isolated environment.

3. Claude Desktop installed.
What this is for: Claude Desktop is the MCP client that starts and uses your local server.

4. This repository cloned locally.
What this is for: Claude Desktop needs a stable local path to your server script.

## Project files

- `server.py`: MCP server implementation and tool definitions.
- `pyproject.toml`: Project metadata and dependencies (includes `mcp`).
- `uv.lock`: Resolved, pinned dependency lock file generated by `uv`.
- `.venv/`: Local virtual environment created by `uv` (generated during setup).

## Step-by-step setup (existing project)

### 1. Open a terminal in the project folder

```powershell
cd D:\ProjectsAndCerts\MCPs\mcp_calculator_server
```

What this does: makes sure all setup commands run in this project.

### 2. Install uv (if not already installed)

Windows PowerShell:

```powershell
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

macOS/Linux:

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

Verify installation:

```powershell
uv --version
```

What this does: installs the `uv` CLI and confirms your shell can execute it.

### 3. Initialize project metadata and dependencies with uv

Run these commands in order:

```powershell
uv init --app --no-package
uv add mcp
uv lock
uv sync
```

What each command does:

- `uv init --app --no-package`: creates or refreshes `pyproject.toml` for an app/script-style project.
- `uv add mcp`: adds MCP dependency to `pyproject.toml`.
- `uv lock`: resolves dependencies and writes `uv.lock`.
- `uv sync`: creates `.venv` (if missing) and installs dependencies from lock.

### 4. (Optional) Activate virtual environment manually

Windows PowerShell:

```powershell
.\.venv\Scripts\Activate.ps1
```

macOS/Linux:

```bash
source .venv/bin/activate
```

What this does: activates `.venv` in your shell. This is optional when using `uv run`.

### 5. Start the MCP server manually (sanity check)

```powershell
uv run python server.py
```

What this does: starts the MCP server process over stdio. If this command runs without errors, Claude Desktop can launch it too.

Stop the server with `Ctrl+C` after verifying it starts.

## Use the existing project (no setup flow)

If this repository already contains `pyproject.toml` and `uv.lock` (it does), you can skip `uv init`, `uv add`, and `uv lock`.

1. Open a terminal in this repo:

```powershell
cd D:\ProjectsAndCerts\MCPs\mcp_calculator_server
```

2. Install dependencies from lock file:

```powershell
uv sync
```

3. Run the server:

```powershell
uv run python server.py
```

4. Point Claude Desktop to this repo path:

```json
{
  "mcpServers": {
    "calculator": {
      "command": "uv",
      "args": [
        "--directory",
        "D:/ProjectsAndCerts/MCPs/mcp_calculator_server",
        "run",
        "python",
        "server.py"
      ]
    }
  }
}
```

This is the shortest path for using the current project as-is.

## Connect this server to Claude Desktop

### 6. Locate Claude Desktop config file

- Windows: `%APPDATA%\Claude\claude_desktop_config.json`
- macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`

If the file does not exist, create it.

### 7. Add MCP server configuration

Use absolute paths. Example for this project on Windows:

```json
{
  "mcpServers": {
    "calculator": {
      "command": "uv",
      "args": [
        "--directory",
        "D:/ProjectsAndCerts/MCPs/mcp_calculator_server",
        "run",
        "python",
        "server.py"
      ]
    }
  }
}
```

If you already have other servers configured, keep them and add this `calculator` entry under `mcpServers`.

What this does: tells Claude Desktop exactly how to start your MCP server process.

### 8. Restart Claude Desktop

Fully quit and reopen Claude Desktop after editing config.

What this does: reloads the MCP server definitions from config.

### 9. Verify tool usage in Claude Desktop

Try prompts such as:

- `Use the calculator tool to add 123 and 456.`
- `Use calculator to divide 22 by 7.`
- `Use the calculator tool to multiply 19 and 8, then subtract 12.`

What this does: confirms Claude can discover and invoke your MCP tools.

## How the server code works

- `mcp = FastMCP("calculator")`: creates the MCP server instance.
- `@mcp.tool()`: exposes each Python function as a tool callable by Claude.
- `mcp.run()`: starts the stdio MCP server loop.

## Common issues and fixes

1. `uv` not found
- Fix: reinstall `uv`, then restart terminal/Claude Desktop so `PATH` refreshes.

2. Claude does not show tools
- Fix: confirm absolute paths in config and restart Claude Desktop.

3. Dependency/import errors
- Fix: run `uv sync` again in the project root.

4. Wrong working directory
- Fix: keep `--directory` pointing to this repo path in Claude config.

5. JSON config invalid
- Fix: validate commas/braces in `claude_desktop_config.json`.

6. `uv sync` fails with hatchling wheel build error
- Symptom: error says it cannot determine files to ship in wheel.
- Cause: repo is being treated as a package even though this is an app/script project.
- Fix: keep this in `pyproject.toml`:

```toml
[tool.uv]
package = false
```

Then run:

```powershell
uv sync
```

## Daily usage commands

From project root:

```powershell
uv sync
uv run python server.py
```

If dependencies are already installed, usually only this is needed:

```powershell
uv run python server.py
```

